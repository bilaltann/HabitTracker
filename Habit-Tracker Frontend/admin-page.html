<!DOCTYPE html>
<html lang="tr">
<head>
    <meta charset="UTF-8">
    <title>Yönetici Paneli | HabitQuest</title>
    <link href="https://fonts.googleapis.com/css2?family=Poppins:wght@300;400;500;600;700&display=swap" rel="stylesheet">
    <link href="https://fonts.googleapis.com/icon?family=Material+Icons" rel="stylesheet">

    <link rel="stylesheet" href="style.css">
    <link rel="stylesheet" href="toast.css">

    <style>
        .tab-content {
            display: none;
            animation: fadeIn 0.4s ease;
        }

            .tab-content.active {
                display: block;
            }

        @keyframes fadeIn {
            from {
                opacity: 0;
                transform: translateY(5px);
            }

            to {
                opacity: 1;
                transform: translateY(0);
            }
        }

        .admin-table {
            width: 100%;
            border-collapse: separate;
            border-spacing: 0 8px;
            margin-top: 15px;
        }

            .admin-table th {
                text-align: left;
                padding: 15px;
                color: #666;
                font-size: 13px;
                font-weight: 600;
                text-transform: uppercase;
                letter-spacing: 0.5px;
            }

            .admin-table td {
                background: rgba(255,255,255,0.7);
                padding: 15px;
                vertical-align: middle;
                border-bottom: 1px solid rgba(0,0,0,0.03);
                font-size: 14px;
            }

            .admin-table tr:hover td {
                background: #fff;
                transform: scale(1.002);
                box-shadow: 0 2px 10px rgba(0,0,0,0.05);
                transition: 0.2s;
            }

            .admin-table tr td:first-child {
                border-top-left-radius: 10px;
                border-bottom-left-radius: 10px;
            }

            .admin-table tr td:last-child {
                border-top-right-radius: 10px;
                border-bottom-right-radius: 10px;
            }

        .avatar-circle {
            width: 32px;
            height: 32px;
            border-radius: 50%;
            background: #e0e7ff;
            color: var(--primary-color);
            display: flex;
            align-items: center;
            justify-content: center;
            font-weight: 600;
            font-size: 13px;
            margin-right: 10px;
        }

        .badge {
            padding: 5px 10px;
            border-radius: 6px;
            font-size: 11px;
            font-weight: 600;
            white-space: nowrap;
        }

        .badge-success {
            background: #dcfce7;
            color: #166534;
        }

        .badge-warning {
            background: #fef9c3;
            color: #854d0e;
        }

        .badge-danger {
            background: #fee2e2;
            color: #991b1b;
        }

        .friendship-grid {
            display: grid;
            grid-template-columns: repeat(auto-fill, minmax(320px, 1fr));
            gap: 15px;
            margin-top: 15px;
        }

        .friendship-card {
            background: rgba(255,255,255,0.7);
            padding: 15px;
            border-radius: 12px;
            display: flex;
            align-items: center;
            justify-content: space-between;
            border: 1px solid transparent;
            transition: 0.2s;
        }

            .friendship-card:hover {
                background: #fff;
                border-color: #e5e7eb;
                box-shadow: 0 4px 15px rgba(0,0,0,0.05);
            }

        .btn-icon {
            width: 30px;
            height: 30px;
            border-radius: 6px;
            border: none;
            cursor: pointer;
            display: inline-flex;
            align-items: center;
            justify-content: center;
            transition: 0.2s;
            margin-left: 5px;
        }

        .btn-edit {
            background: #eff6ff;
            color: #2563eb;
        }

        .btn-delete {
            background: #fef2f2;
            color: #dc2626;
        }

        .btn-icon:hover {
            filter: brightness(0.9);
            transform: translateY(-1px);
        }

       

        
        .dashboard-widgets {
            display: grid;
            grid-template-columns: 2fr 0fr; 
            gap: 20px;
            margin-top: 20px;
        }

        @media (max-width: 900px) {
            .dashboard-widgets {
                grid-template-columns: 1fr;
            }
            
        }

        .widget-box {
            padding: 20px;
            min-height: 300px;
        }

        .widget-header {
            display: flex;
            justify-content: space-between;
            align-items: center;
            margin-bottom: 20px;
            border-bottom: 1px solid rgba(0,0,0,0.05);
            padding-bottom: 10px;
        }

            .widget-header h3 {
                margin: 0;
                font-size: 16px;
                color: #333;
            }

        /* Aktivite Listesi */
        .activity-item {
            display: flex;
            align-items: center;
            padding: 12px 0;
            border-bottom: 1px solid rgba(0,0,0,0.03);
        }

            .activity-item:last-child {
                border-bottom: none;
            }

        .act-icon {
            width: 36px;
            height: 36px;
            border-radius: 8px;
            display: flex;
            align-items: center;
            justify-content: center;
            color: white;
            margin-right: 15px;
            flex-shrink: 0;
        }
        /* Renk sınıfları */
        .bg-blue {
            background: #3b82f6;
        }

        .bg-green {
            background: #10b981;
        }

        .bg-orange {
            background: #f59e0b;
        }

        .act-details h4 {
            margin: 0;
            font-size: 14px;
            color: #333;
            font-weight: 500;
        }

        .act-details p {
            margin: 2px 0 0;
            font-size: 12px;
            color: #666;
        }

        .act-time {
            margin-left: auto;
            font-size: 11px;
            color: #999;
        }

        /* Sistem Durumu Barları */
        .system-status-item {
            margin-bottom: 20px;
        }

        .status-info {
            display: flex;
            justify-content: space-between;
            margin-bottom: 5px;
            font-size: 13px;
            font-weight: 500;
            color: #555;
        }

        .progress-bar {
            width: 100%;
            height: 8px;
            background: #e5e7eb;
            border-radius: 4px;
            overflow: hidden;
        }

        .progress-fill {
            height: 100%;
            background: var(--primary-color);
            border-radius: 4px;
            transition: width 0.5s ease;
        }

        .status-badge {
            padding: 4px 8px;
            border-radius: 4px;
            font-size: 11px;
        }

        .status-ok {
            background: #dcfce7;
            color: #166534;
        }

        .status-err {
            background: #fee2e2;
            color: #991b1b;
        }

        .status-gray {
            background: #f3f4f6;
            color: #6b7280;
        }

        .empty-state {
            text-align: center;
            padding: 40px;
            color: #999;
            display: flex;
            flex-direction: column;
            align-items: center;
            gap: 10px;
        }
    </style>
</head>
<body>

    <header class="glass-header">
        <div class="header-content">
            <div class="logo-container">
                <span class="material-icons" style="color: var(--primary-color); font-size: 28px;">admin_panel_settings</span>
                <div style="display:flex; flex-direction:column; margin-left:10px;">
                    <span style="font-weight:700; color:#333; font-size:16px;">Yönetim Paneli</span>
                </div>
            </div>
            <button class="btn-logout" id="logout-btn">
                <span class="material-icons" style="font-size: 18px;">logout</span> Çıkış
            </button>
        </div>
    </header>

    <div class="container">
        <aside class="sidebar glass-panel">
            <h4 style="margin:0 0 15px 10px; color:#999; font-size:11px; text-transform:uppercase; letter-spacing:1px;">Genel</h4>

            <div class="nav-item active" onclick="switchTab('dashboard', this)">
                <span class="material-icons">dashboard</span> <span>Özet Durum</span>
            </div>

            <h4 style="margin:25px 0 15px 10px; color:#999; font-size:11px; text-transform:uppercase; letter-spacing:1px;">Kayıtlar</h4>

            <div class="nav-item" onclick="switchTab('users', this)">
                <span class="material-icons">group</span> <span>Kullanıcı Listesi</span>
            </div>

            <div class="nav-item" onclick="switchTab('friendships', this)">
                <span class="material-icons">diversity_3</span> <span>Arkadaşlıklar</span>
            </div>

            <div class="nav-item" onclick="switchTab('badges', this)">
                <span class="material-icons">military_tech</span> <span>Rozet Yönetimi</span>
            </div>

            <h4 style="margin:25px 0 15px 10px; color:#999; font-size:11px; text-transform:uppercase; letter-spacing:1px;">Sistem</h4>

            <div class="nav-item" onclick="switchTab('logs', this)">
                <span class="material-icons">bug_report</span> <span>Sistem Logları</span>
            </div>
        </aside>

        <main class="content-area">

            <section id="tab-dashboard" class="tab-content active">

                <div class="stats-grid">
                    <div class="stat-card glass-panel">
                        <div class="stat-icon purple"><span class="material-icons">people</span></div>
                        <div>
                            <h2 style="margin:0;" id="stat-total-users">-</h2>
                            <span style="color:#666; font-size:13px;">Toplam Üye</span>
                        </div>
                    </div>
                   
                    <div class="stat-card glass-panel">
                        <div class="stat-icon purple" style="background: linear-gradient(135deg, #10B981, #059669);"><span class="material-icons">check_circle</span></div>
                        <div>
                            <h2 style="margin:0;" id="stat-total-habits">-</h2>
                            <span style="color:#666; font-size:13px;">Toplam Alışkanlıklar</span>
                        </div>
                    </div>
                </div>

                <div class="dashboard-widgets">

                    <div class="glass-panel widget-box">
                        <div class="widget-header">
                            <h3>Son Sistem Hareketleri</h3>
                            <button class="btn-icon" onclick="loadActivities()" title="Yenile"><span class="material-icons">refresh</span></button>
                        </div>

                        <div id="activity-list" class="activity-list">
                            <div class="empty-state">
                                <span class="material-icons">hourglass_empty</span>
                                <p>Aktivite verileri bekleniyor...</p>
                            </div>
                        </div>
                    </div>

                   

                      
                </div>
            </section>

            <section id="tab-users" class="tab-content">
                <div class="glass-panel">
                    <!-- Başlık ve Arama Alanı -->
                    <div style="display:flex; justify-content:space-between; align-items:center; margin-bottom:20px; gap: 15px;">
                        <h3 style="margin:0; white-space:nowrap;">Kullanıcılar</h3>

                        <!-- ARAMA KUTUSU -->
                        <div style="position: relative; width: 100%; max-width: 300px;">
                            <span class="material-icons" style="position: absolute; left: 10px; top: 50%; transform: translateY(-50%); color: #999; font-size: 18px;">search</span>
                            <input type="text" id="user-search-input" placeholder="İsim veya E-posta ara..."
                                   style="width: 100%; padding: 8px 10px 8px 35px; border: 1px solid #ddd; border-radius: 8px; outline: none; font-size: 13px;">
                        </div>

                        <button class="btn-primary" onclick="loadUsers()" title="Listeyi Yenile">
                            <span class="material-icons" style="font-size:16px; vertical-align:middle;">refresh</span>
                        </button>
                    </div>

                    <table class="admin-table">
                        <thead>
                            <tr>
                                <th>Kullanıcı</th>
                                <th>E-posta</th>
                                <th>Rol</th>
                                <th style="text-align:right;">İşlemler</th>
                            </tr>
                        </thead>
                        <tbody id="user-list-container">
                            <tr><td colspan="4" style="text-align:center; padding:20px;">Veriler bekleniyor...</td></tr>
                        </tbody>
                    </table>
                </div>
            </section>

            <section id="tab-friendships" class="tab-content">
                <div class="glass-panel">
                    <div style="display:flex; justify-content:space-between; align-items:center;">
                        <h3>Arkadaşlık Bağlantıları</h3>
                        <button class="btn-primary" onclick="loadFriendships()">
                            <span class="material-icons" style="font-size:16px; vertical-align:middle;">refresh</span>
                        </button>
                    </div>

                    <div id="friendship-list-container" class="friendship-grid">
                        <div style="grid-column:1/-1; text-align:center; padding:20px; color:#666;">Veriler bekleniyor...</div>
                    </div>
                </div>
            </section>
            <section id="tab-badges" class="tab-content">

                <!-- Üst Kısım: Yeni Ekleme Formu -->
                <div class="glass-panel" style="margin-bottom: 20px;">
                    <h3 style="color: var(--primary-color); margin-bottom: 15px; display:flex; align-items:center; gap:10px;">
                        <span class="material-icons">add_photo_alternate</span> Yeni Rozet Ekle
                    </h3>

                    <form id="add-badge-form" style="display: grid; grid-template-columns: 1fr 1fr 1fr auto; gap: 15px; align-items: end;">

                        <div>
                            <label style="font-size:12px; font-weight:600; color:#666;">Rozet Adı</label>
                            <input type="text" id="badge-name" placeholder="Örn: Erken Kalkan" required
                                   style="width:100%; padding:10px; border:1px solid #ddd; border-radius:8px;">
                        </div>

                        <div>
                            <label style="font-size:12px; font-weight:600; color:#666;">Açıklama</label>
                            <input type="text" id="badge-desc" placeholder="Açıklama giriniz..." required
                                   style="width:100%; padding:10px; border:1px solid #ddd; border-radius:8px;">
                        </div>

                        <div>
                            <label style="font-size:12px; font-weight:600; color:#666;">Resim Seç</label>
                            <input type="file" id="badge-file" accept="image/*" required
                                   style="width:100%; padding:7px; background:#f9f9f9; border:1px dashed #ccc; border-radius:8px;">
                        </div>

                        <button type="submit" class="btn-primary" style="height: 42px;">
                            <span class="material-icons" style="font-size:18px; vertical-align:middle;">upload</span> Yükle
                        </button>
                    </form>
                </div>

                <!-- Alt Kısım: Rozet Listesi -->
                <div class="glass-panel">
                    <div style="display:flex; justify-content:space-between; align-items:center; margin-bottom:15px;">
                        <h3>Mevcut Rozetler</h3>
                        <button class="btn-icon" onclick="loadBadges()" title="Yenile" style="background:#e0e7ff; color:var(--primary-color);">
                            <span class="material-icons">refresh</span>
                        </button>
                    </div>

                    <table class="admin-table">
                        <thead>
                            <tr>
                                <th style="width: 80px;">Görsel</th>
                                <th>Rozet Adı</th>
                                <th>Açıklama</th>
                                <th>Dosya Yolu</th>
                            </tr>
                        </thead>
                        <tbody id="badge-list-container">
                            <tr><td colspan="4" style="text-align:center; padding:20px;">Veriler bekleniyor...</td></tr>
                        </tbody>
                    </table>
                </div>

            </section>

            <section id="tab-logs" class="tab-content">
                <div class="glass-panel">
                    <div style="display:flex; justify-content:space-between; align-items:center; margin-bottom:15px;">
                        <h3>Sistem Hata Kayıtları</h3>
                        <button class="btn-primary" onclick="loadSystemLogs()">
                            <span class="material-icons" style="font-size:16px; vertical-align:middle;">refresh</span> Yenile
                        </button>
                    </div>

                    <table class="admin-table">
                        <thead>
                            <tr>
                                <th style="width: 150px;">Tarih</th>
                                <th style="width: 100px;">Seviye</th>
                                <th>Mesaj</th>
                                <th style="width: 80px;">Detay</th>
                            </tr>
                        </thead>
                        <tbody id="log-list-container">
                            <tr><td colspan="4" style="text-align:center; padding:20px;">Loglar yükleniyor...</td></tr>
                        </tbody>
                    </table>
                </div>
            </section>
        </main>
    </div>
    <!-- MODAL: KULLANICI DÜZENLEME -->
    <div class="modal-overlay" id="edit-user-modal">
        <div class="modal-content glass-panel">
            <span class="material-icons close-modal" onclick="closeEditUserModal()">close</span>
            <h2 style="text-align:center; margin-bottom:20px; color:#4F46E5;">Kullanıcı Düzenle</h2>

            <form id="edit-user-form">
                <input type="hidden" id="edit-user-id">

                <div class="input-group" style="margin-bottom: 15px;">
                    <label style="font-size:12px; color:#666;">Ad Soyad</label>
                    <input type="text" id="edit-user-name" required style="width: 100%; padding: 10px; border-radius: 8px; border: 1px solid #ddd; margin-top:5px;">
                </div>

                <div class="input-group" style="margin-bottom: 15px;">
                    <label style="font-size:12px; color:#666;">E-posta</label>
                    <input type="email" id="edit-user-email" required style="width: 100%; padding: 10px; border-radius: 8px; border: 1px solid #ddd; margin-top:5px;">
                </div>

                <div class="input-group" style="margin-bottom: 25px;">
                    <label style="font-size:12px; color:#666;">Rol</label>
                    <select id="edit-user-role" style="width: 100%; padding: 10px; border-radius: 8px; border: 1px solid #ddd; margin-top:5px;">
                        <option value="User">User (Standart)</option>
                        <option value="Admin">Admin (Yönetici)</option>
                    </select>
                </div>

                <button type="submit" class="btn-primary" style="width: 100%; padding:12px;">Güncelle</button>
            </form>
        </div>
    </div>

    <!-- MODAL: KULLANICI SİLME ONAYI -->
    <div class="modal-overlay" id="delete-user-modal">
        <div class="modal-content glass-panel" style="text-align: center;">
            <span class="material-icons close-modal" onclick="closeDeleteUserModal()">close</span>

            <div style="width: 60px; height: 60px; background-color: #fee2e2; border-radius: 50%; display: flex; align-items: center; justify-content: center; margin: 0 auto 15px;">
                <span class="material-icons" style="font-size: 32px; color: #ef4444;">warning</span>
            </div>

            <h3 style="margin-bottom: 10px; color: #1f2937;">Emin misiniz?</h3>
            <p style="color: #666; font-size: 14px; margin-bottom: 25px;">
                Bu kullanıcıyı silmek istediğinize emin misiniz?<br>Bu işlem geri alınamaz.
            </p>

            <input type="hidden" id="delete-user-id-input">

            <div style="display: flex; gap: 10px; justify-content: center;">
                <button onclick="closeDeleteUserModal()" class="btn-cancel">Vazgeç</button>
                <button onclick="confirmDeleteUser()" class="btn-delete-confirm">Evet, Sil</button>
            </div>
        </div>
    </div>

    <!-- MODAL: ARKADAŞLIK BİTİRME ONAYI -->
    <div class="modal-overlay" id="delete-friendship-modal">
        <div class="modal-content glass-panel" style="text-align: center;">
            <span class="material-icons close-modal" onclick="closeDeleteFriendshipModal()">close</span>

            <div style="width: 60px; height: 60px; background-color: #fee2e2; border-radius: 50%; display: flex; align-items: center; justify-content: center; margin: 0 auto 15px;">
                <span class="material-icons" style="font-size: 32px; color: #ef4444;">warning</span>
            </div>

            <h3 style="margin-bottom: 10px; color: #1f2937;">Emin misiniz?</h3>
            <p style="color: #666; font-size: 14px; margin-bottom: 25px;">
                Bu arkadaşlığı bitirmek istediğinize emin misiniz?<br>Bu işlem geri alınamaz.
            </p>

            <input type="hidden" id="delete-friendship-id-input">

            <div style="display: flex; gap: 10px; justify-content: center;">
                <button onclick="closeDeleteFriendshipModal()" class="btn-cancel">Vazgeç</button>
                <button onclick="confirmDeleteFriendship()" class="btn-delete-confirm">Evet, Sil</button>
            </div>
        </div>
    </div>
    <script type="module" src="js/adminpage.js"></script>

</body>
</html>